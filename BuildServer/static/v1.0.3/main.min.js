function getRandomNum(t,e){var i=e-t,a=Math.random();return t+Math.round(a*i)}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),VerticalLayout=function(t){function e(e){var i=t.call(this)||this;return i._layoutWidth=573,i._layoutHeight=573,i._layoutBgColor=15658734,i._layoutBgColorAlpha=1,i._layoutSpacing=20,i._layoutPaddingTop=0,i._layoutPaddingLeft=0,i.reDraw(),i}return __extends(e,t),Object.defineProperty(e.prototype,"layoutWidth",{get:function(){return this._layoutWidth},set:function(t){this._layoutWidth=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutHeight",{get:function(){return this._layoutHeight},set:function(t){this._layoutHeight=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutBgColor",{get:function(){return this._layoutBgColor},set:function(t){this._layoutBgColor=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutBgColorAlpha",{get:function(){return this._layoutBgColorAlpha},set:function(t){this._layoutBgColorAlpha=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutPaddingTop",{get:function(){return this._layoutPaddingTop},set:function(t){this._layoutPaddingTop=t,this.reDrawChildren()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutPaddingLeft",{get:function(){return this._layoutPaddingLeft},set:function(t){this._layoutPaddingLeft=t,this.reDrawChildren()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutSpacing",{get:function(){return this._layoutSpacing},set:function(t){this._layoutSpacing=t,this.reDrawChildren()},enumerable:!0,configurable:!0}),e.prototype.reDraw=function(){this.graphics.clear(),this.graphics.beginFill(this._layoutBgColor,this._layoutBgColorAlpha),this.graphics.drawRect(0,0,this._layoutWidth,this._layoutHeight),this.graphics.endFill()},e.prototype.reDrawChildren=function(){for(var t=[],e=0,i=this.$children.length;i>e;e++)t.push(this.$children[e]);this.removeChildren();for(var e=0,i=t.length;i>e;e++)this.addLayoutChild(t[e])},e.prototype.addLayoutChild=function(t,e){void 0===e&&(e=this.$children.length-1);var i=this.$children.length;if(0===i)t.x=this._layoutPaddingLeft,t.y=this._layoutPaddingTop,this.addChild(t);else{var a=this.getChildAt(i-1);t.x=this._layoutPaddingLeft,t.y=a.y+a.height+this._layoutSpacing,this.addChild(t)}},e}(egret.Sprite);__reflect(VerticalLayout.prototype,"VerticalLayout");var StartScene=function(t){function e(e){var i=t.call(this)||this;return i.totalCost=16,i._remainCost=i.totalCost,i.par=e,i.createScene(),i}return __extends(e,t),Object.defineProperty(e.prototype,"remainCost",{get:function(){return this._remainCost},set:function(t){this._remainCost=t,this.textCost&&(this._remainCost<0?this.textCost.text="你用了太多 Cost 了，节制一下 :) 剩余 Cost："+this._remainCost.toString():this.textCost.text="剩余 Cost："+this._remainCost.toString())},enumerable:!0,configurable:!0}),e.prototype.createScene=function(){this.textRoom=new egret.TextField,this.textRoom.x=30,this.textRoom.y=30,this.textRoom.text="房间号码",this.addChild(this.textRoom),this.inputRoom=new egret.TextField,this.inputRoom.width=100,this.inputRoom.height=60,this.inputRoom.restrict="0-9 A-Z_a-z",this.inputRoom.multiline=!1,this.inputRoom.type=egret.TextFieldType.INPUT,this.inputRoom.verticalAlign=egret.VerticalAlign.MIDDLE,this.inputRoom.x=this.textRoom.x+150,this.inputRoom.y=this.textRoom.y-20,this.inputRoom.background=!0,this.inputRoom.backgroundColor=16777215,this.inputRoom.textColor=0,this.inputRoom.addEventListener(egret.Event.CHANGE,this.inputRoomListen,this),this.addChild(this.inputRoom),this.textName=new egret.TextField,this.textName.x=300,this.textName.y=this.textRoom.y,this.textName.text="玩家名字",this.addChild(this.textName),this.inputName=new egret.TextField,this.inputName.width=150,this.inputName.height=60,this.inputName.restrict="0-9 A-Z_a-z",this.inputName.multiline=!1,this.inputName.verticalAlign=egret.VerticalAlign.MIDDLE,this.inputName.type=egret.TextFieldType.INPUT,this.inputName.x=this.textName.x+150,this.inputName.y=this.textName.y-20,this.inputName.background=!0,this.inputName.backgroundColor=16777215,this.inputName.textColor=0,this.inputName.addEventListener(egret.Event.CHANGE,this.inputNameListen,this),this.addChild(this.inputName);var t=new HorizontalLayout(this.par);t.x=60,t.y=this.textName.y+60,t.layoutWidth=400,t.layoutHeight=50,t.layoutBgColorAlpha=0,this.addChild(t),this.btnBai=new ImgBtn(this.par,50,50),this.btnBai.text="白",this.btnBai.textY=10,t.addLayoutChild(this.btnBai),this.btnWei=new ImgBtn(this.par,50,50),this.btnWei.text="魏",this.btnWei.textY=10,t.addLayoutChild(this.btnWei),this.btnShu=new ImgBtn(this.par,50,50),this.btnShu.text="蜀",this.btnShu.textY=10,t.addLayoutChild(this.btnShu),this.btnWu=new ImgBtn(this.par,50,50),this.btnWu.text="吴",this.btnWu.textY=10,t.addLayoutChild(this.btnWu),this.btnQun=new ImgBtn(this.par,50,50),this.btnQun.text="群",this.btnQun.textY=10,t.addLayoutChild(this.btnQun),this.btnJin=new ImgBtn(this.par,50,50),this.btnJin.text="晋",this.btnJin.textY=10,t.addLayoutChild(this.btnJin),this.btnBai.addEventListener("touchTap",this.onBtnBaiTap,this),this.btnWei.addEventListener("touchTap",this.onBtnWeiTap,this),this.btnShu.addEventListener("touchTap",this.onBtnShuTap,this),this.btnWu.addEventListener("touchTap",this.onBtnWuTap,this),this.btnQun.addEventListener("touchTap",this.onBtnQunTap,this),this.btnJin.addEventListener("touchTap",this.onBtnJinTap,this),this.chosenPower="白",this.textPower=new egret.TextField,this.textPower.x=30,this.textPower.y=t.y+70,this.textPower.text="当前选择势力："+this.chosenPower+"  请安排武将的位置(1-6号)",this.addChild(this.textPower),this.textCost=new egret.TextField,this.textCost.x=30,this.textCost.y=this.textPower.y+30,this.textCost.text="剩余 Cost："+this._remainCost,this.addChild(this.textCost),this.chosenGenerals=GeneralTable.getGeneralsByPower("白"),this.cardPool=new CardPool(this.chosenGenerals),this.cardPool.x=50,this.cardPool.y=this.textCost.y+30,this.cardPool.cardTapHandler=this,this.addChild(this.cardPool),this.generalSortLayout=new VerticalLayout(this.par),this.generalSortLayout.x=60,this.generalSortLayout.y=this.cardPool.y+this.cardPool.height+10,this.generalSortLayout.layoutWidth=400,this.generalSortLayout.layoutHeight=100,this.generalSortLayout.layoutBgColorAlpha=0,this.generalSortLayout.layoutSpacing=8,this.addChild(this.generalSortLayout),this.setGeneralSortLayout(),this.btnConnect=new ImgBtn(this,200,60),this.btnConnect.text="连接",this.btnConnect.x=500,this.btnConnect.y=1e3,this.btnConnect.textY=20,this.btnConnect.textSize=25,this.btnConnect.addEventListener("touchTap",this.onBtnConnectTap,this),this.addChild(this.btnConnect),this.btnAbout=new ImgBtn(this,200,60),this.btnAbout.text="关于本游戏",this.btnAbout.x=this.btnConnect.x,this.btnAbout.y=this.btnConnect.y+this.btnConnect.height+5,this.btnAbout.textY=20,this.btnAbout.textSize=25,this.btnAbout.addEventListener("touchTap",this.onBtnAboutTap,this),this.addChild(this.btnAbout),this.textLog=new egret.TextField,this.textLog.x=350,this.textLog.y=730,this.textLog.text="",this.textLog.width=650,this.textLog.height=260,this.addChild(this.textLog)},e.prototype.inputRoomListen=function(){if(this.inputRoom.text.length>8){var t=this.inputRoom.text,e=t.slice(0,8);this.inputRoom.text=e}},e.prototype.inputNameListen=function(){if(this.inputName.text.length>8){var t=this.inputName.text,e=t.slice(0,8);this.inputName.text=e}},e.prototype.handleCardTapEvent=function(t){for(var e=[0,1,2,3,4,5],i=0;i<this.generalSingleLayouts.length;i++){var a=this.generalSingleLayouts[i],s=a.pos,r=e.indexOf(Number(s));if(-1!==r){var n=e.slice(0,r),o=e.slice(r+1,e.length);e=n.concat(o)}}var h=e.length>0?e[0].toString():"-1",l=new GeneralSingleLayout(this,t.general,h);l.eventHandler=this,this.generalSingleLayouts.push(l),this.generalSortLayout.addLayoutChild(l),this.checkCost();var c=this.cardPool.generalList.slice(0,this.cardPool.cardIndex),u=this.cardPool.generalList.slice(this.cardPool.cardIndex+1,this.cardPool.generalList.length),d=c.concat(u),p=this.cardPool.cardIndex;this.cardPool.generalList=d,this.cardPool.cardIndex=0>p-1?p:p-1},e.prototype.setGeneralSortLayout=function(){var t=this.chosenGenerals;this.generalSingleLayouts=[],this.generalSortLayout.removeChildren(),this.cardPool.generalList=t},e.prototype.handleChosenEvent=function(t){this.removeChosenGeneral(t)},e.prototype.removeChosenGeneral=function(t){for(var e=0;e<this.generalSingleLayouts.length;e++)if(t.number===this.generalSingleLayouts[e].general.number){var i=this.generalSingleLayouts.slice(0,e),a=this.generalSingleLayouts.slice(e+1,this.generalSingleLayouts.length),s=this.generalSingleLayouts[e],r=i.concat(a);this.generalSingleLayouts=r,this.generalSortLayout.removeChild(s),this.generalSortLayout.reDrawChildren(),this.checkCost();var n=this.cardPool.cardIndex,o=this.cardPool.generalList.slice(0,n),h=this.cardPool.generalList.slice(n,this.cardPool.generalList.length),l=[s.general],c=o.concat(l,h);this.cardPool.generalList=c,this.cardPool.cardIndex=n}},e.prototype.checkCost=function(){for(var t=0,e=0;e<this.generalSingleLayouts.length;e++){var i=this.generalSingleLayouts[e];t+=i.general.cost}this.remainCost=this.totalCost-t,this.remainCost<0?(this.btnConnect.touchEnabled=!1,this.btnConnect.clickable=!1):(this.btnConnect.touchEnabled=!0,this.btnConnect.clickable=!0)},e.prototype.onBtnBaiTap=function(){this.onBtnPowerTap("白")},e.prototype.onBtnWeiTap=function(){this.onBtnPowerTap("魏")},e.prototype.onBtnShuTap=function(){this.onBtnPowerTap("蜀")},e.prototype.onBtnWuTap=function(){this.onBtnPowerTap("吴")},e.prototype.onBtnQunTap=function(){this.onBtnPowerTap("群")},e.prototype.onBtnJinTap=function(){this.onBtnPowerTap("晋")},e.prototype.onBtnPowerTap=function(t){this.chosenPower=t,this.chosenGenerals=GeneralTable.getGeneralsByPower(t),this.textPower.text="当前选择势力："+this.chosenPower+"  请安排武将的位置(1-6号)",this.remainCost=16,this.setGeneralSortLayout()},e.prototype.onBtnConnectTap=function(){this.disableAllTouchable(),this.appendLog("连接服务器中");var t=Constant.REMOTE_SERVER_IP;Constant.REMOTE_SERVER_PORT;this.socket&&this.socket.connected&&this.socket.close(),this.socket=GameSocket.getInstance(),this.addSocketListener(),this.socket.connect(t,7231)},e.prototype.appendLog=function(t){var e=this.textLog.text,i=t+"\n"+e;this.textLog.text=i},e.prototype.disableAllTouchable=function(){this.loading=!0,this.btnAbout.touchEnabled=!1,this.btnAbout.clickable=!1,this.btnConnect.touchEnabled=!1,this.btnConnect.clickable=!1,this.btnBai.touchEnabled=!1,this.btnBai.clickable=!1,this.btnWei.touchEnabled=!1,this.btnWei.clickable=!1,this.btnShu.touchEnabled=!1,this.btnShu.clickable=!1,this.btnWu.touchEnabled=!1,this.btnWu.clickable=!1,this.btnQun.touchEnabled=!1,this.btnQun.clickable=!1,this.btnJin.touchEnabled=!1,this.btnJin.clickable=!1,this.inputRoom.type=egret.TextFieldType.DYNAMIC,this.inputName.type=egret.TextFieldType.DYNAMIC;for(var t=0;t<this.generalSingleLayouts.length;t++){var e=this.generalSingleLayouts[t];e.disableAllTouchable()}this.cardPool.leftBtn.touchEnabled=!1,this.cardPool.leftBtn.clickable=!1,this.cardPool.rightBtn.touchEnabled=!1,this.cardPool.rightBtn.clickable=!1,this.cardPool.currentCard.touchEnabled=!1,this.cardPool.currentCard.clickable=!1},e.prototype.enableAllTouchable=function(){this.loading=!1,this.btnAbout.touchEnabled=!0,this.btnAbout.clickable=!0,this.btnConnect.touchEnabled=!0,this.btnConnect.clickable=!0,this.btnBai.touchEnabled=!0,this.btnBai.clickable=!0,this.btnWei.touchEnabled=!0,this.btnWei.clickable=!0,this.btnShu.touchEnabled=!0,this.btnShu.clickable=!0,this.btnWu.touchEnabled=!0,this.btnWu.clickable=!0,this.btnQun.touchEnabled=!0,this.btnQun.clickable=!0,this.btnJin.touchEnabled=!0,this.btnJin.clickable=!0,this.inputRoom.type=egret.TextFieldType.INPUT,this.inputName.type=egret.TextFieldType.INPUT;for(var t=0;t<this.generalSingleLayouts.length;t++){var e=this.generalSingleLayouts[t];e.enableAllTouchable()}this.cardPool.leftBtn.touchEnabled=!0,this.cardPool.leftBtn.clickable=!0,this.cardPool.rightBtn.touchEnabled=!0,this.cardPool.rightBtn.clickable=!0,this.cardPool.currentCard.touchEnabled=!0,this.cardPool.currentCard.clickable=!0},e.prototype.onSocketOpen=function(){console.log("open"),this.sendChosenData()},e.prototype.sendChosenData=function(){for(var t=this.inputRoom.text,e=this.inputName.text,i=[],a=0;a<this.generalSingleLayouts.length;a++){var s=this.generalSingleLayouts[a],r={num:s.general.number,pos:s.pos};i.push(r)}var n=JSON.stringify({reqStr:"enterRoom",roomName:t,userName:e,gDetail:i});this.socket.writeUTF(n)},e.prototype.onSocketClose=function(){console.log("close"),this.enableAllTouchable()},e.prototype.onSocketError=function(){console.log("error"),this.enableAllTouchable()},e.prototype.onReceiveMessage=function(t){var e=this.socket.readUTF();e=JSON.parse(e),console.log(e),e.msg&&this.appendLog(e.msg);var i=e.status;if(1===i){var a=e.reqStr;switch(a){case"startGame":this.startGame(e)}}},e.prototype.startGame=function(t){var e=(t.msg,t.upPlayer),i=t.downPlayer,a=(t.otherPlayers,0);e===this.inputName.text?a=-1:i===this.inputName.text&&(a=1);for(var s=t.currentCamp,r=t.leftChesses,n=t.rightChesses,o=t.chesses,h=[],l=[],c=[],u=0;u<r.length;u++){var d=r[u],p=r[u].g,g=null;p&&(g=GeneralTable.getGeneralTable()[p.number]),h.push(new HurtedChess(g))}for(var u=0;u<n.length;u++){var d=n[u],p=n[u].g,g=null;p&&(g=GeneralTable.getGeneralTable()[p.number]),l.push(new HurtedChess(g))}for(var u=0;6>u;u++){for(var f=[],x=0;6>x;x++){var b=o[u][x],p=b.g,g=null;p&&(g=GeneralTable.getGeneralTable()[p.number]);var m=b.camp,d=new Chess("normal",g);d.camp=m,f.push(d)}c.push(f)}var y=new InitData;y.playerCamp=a,y.currentCamp=s,y.leftChesses=h,y.rightChesses=l,y.chesses=c,y.upPower=t.upPower,y.downPower=t.downPower,this.removeSocketListener();var v=new GameScene(this.par,y,this);this.par.addChild(v)},e.prototype.onBtnAboutTap=function(){var t=new AboutScene(this.par);t.x=0,t.y=0,this.par.addChild(t)},e.prototype.getChesses=function(){for(var t=[],e=0;6>e;e++){for(var i=[],a=0;6>a;a++){var s=General.getRandomGeneral(),r=new Chess("normal",(0===e||5===e)&&4>a?s:null),n=0;0===e&&4>a?n=-1:5===e&&4>a&&(n=1),r.camp=n,i.push(r)}t.push(i)}return t},e.prototype.removeSocketListener=function(){this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},e.prototype.addSocketListener=function(){this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},e}(egret.Sprite);__reflect(StartScene.prototype,"StartScene",["ChosenEventHandler","CardTapHandler"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createScene=function(){var t=new StartScene(this);this.addChild(t)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Utils=function(){function t(){}return t.is2dAdjacent=function(t,e,i,a){var s=Math.abs(i-t),r=Math.abs(a-e),n=!1;return 0===s&&1===r?n=!0:1===s&&0===r&&(n=!0),n},t}();__reflect(Utils.prototype,"Utils");var Constant=function(){function t(){}return t.REMOTE_SERVER_IP="23.83.226.192",t.REMOTE_SERVER_PORT=7231,t.LOCAL_SERVER_IP="127.168.0.1",t.LOCAL_SERVER_PORT=7231,t}();__reflect(Constant.prototype,"Constant");var InitData=function(){function t(){}return t}();__reflect(InitData.prototype,"InitData");var ArmsInfo=function(){function t(){}return t.getArmsInfoByName=function(e,i){var a=new t;switch(e){case"步":a={moveStep:2,ifStraight:!1,attackRange:1,maxTl:25+2*i};break;case"骑":a={moveStep:3,ifStraight:!1,attackRange:1,maxTl:20+2*i};break;case"弓":a={moveStep:2,ifStraight:!1,attackRange:2,maxTl:15+2*i};break;case"器":a={moveStep:2,ifStraight:!0,attackRange:1,maxTl:25+2*i}}return a},t}();__reflect(ArmsInfo.prototype,"ArmsInfo");var General=function(){function t(){this.number=1,this.power="蜀",this.name="白板",this.rare="SR",this.arms="弓",this.yl=1,this.armsInfo=ArmsInfo.getArmsInfoByName("弓",this.yl),this.zm=10,this.maxTl=this.armsInfo.maxTl,this.tl=this.armsInfo.maxTl,this.yong=!1,this.fu=!0,this.mei=!0,this.cost=0,this.skill=SkillTable.getSkillTable()["白板"],this.hasMoved=!1,this.hasAttacked=!1,this.hasSkilled=!1,this.hurtTurns=0,this.extraYl=0,this.extraZm=0,this.extraAtkRange=0,this.extraMoveStep=0,this.canPenetrate=!1,this.extraMessage={},this.untilDieMessage={},this.lockedMessage={}}return t.parseGeneralByJson=function(e){var i=new t;return i.number=e.number,i.power=e.power,i.name=e.name,i.rare=e.rare,i.arms=e.arms,i.yl=Number(e.yl),i.armsInfo=ArmsInfo.getArmsInfoByName(i.arms,i.yl),i.zm=Number(e.zm),i.maxTl=i.armsInfo.maxTl,i.tl=i.armsInfo.maxTl,i.yong=e.yong,i.fu=e.fu,i.mei=e.mei,i.skill=SkillTable.getSkillTable()[e.skill],i.cost=e.cost,i},t.getRandomGeneral=function(){var e=new t;e.number=1,e.power="蜀",e.name="白\n板",e.rare="SR";var i=getRandomNum(0,3);switch(i){case 0:e.arms="弓";break;case 1:e.arms="骑";break;case 2:e.arms="步";break;case 3:e.arms="器"}e.yl=getRandomNum(1,10);var a=ArmsInfo.getArmsInfoByName(e.arms,e.yl);return e.armsInfo=a,e.zm=getRandomNum(1,10),e.maxTl=a.maxTl,e.tl=a.maxTl,e.yong=1===getRandomNum(0,2)?!0:!1,e.fu=1===getRandomNum(0,2)?!0:!1,e.mei=1===getRandomNum(0,2)?!0:!1,e.cost=getRandomNum(0,10),e},t}();__reflect(General.prototype,"General");var GeneralTable=function(){function t(){}return t.getGeneralTable=function(){return t.$GeneralTable||(t.$GeneralTable=t.createTable()),t.$GeneralTable},t.createTable=function(){var t=RES.getRes("generals_json"),e={};for(var i in t){var a=General.parseGeneralByJson(t[i]),s=a.skill;switch(s.name){case"虎豹骑":a.armsInfo.attackRange+=1,a.armsInfo.moveStep+=1,a.yl+=1;break;case"无当飞军":a.tl+=5,a.maxTl+=5,a.armsInfo.attackRange+=1,a.armsInfo.moveStep+=1;break;case"丹阳卫":a.tl+=5,a.maxTl+=5,a.yl+=1,a.armsInfo.moveStep+=1;break;case"陷阵营":a.armsInfo.moveStep+=1,a.tl+=5,a.maxTl+=5}e[i]=a}return e},t.getGeneralsByPower=function(t){var e=[];for(var i in this.getGeneralTable()){var a=this.getGeneralTable()[i];a.power===t&&e.push(a)}return e},t.getGeneralsByKey=function(t){for(var e=[],i=0;i<t.length;i++){var a=this.getGeneralTable()[t[i]];e.push(a)}return e},t}();__reflect(GeneralTable.prototype,"GeneralTable");var Skill=function(){function t(t){t?(this.name=t.name,this.type=t.type,this.cost=t.cost,this.text=t.text,this.onceUsed=!1):(this.name="No",this.type="",this.cost="",this.text="",this.onceUsed=!1)}return t}();__reflect(Skill.prototype,"Skill");var SkillTable=function(){function t(){}return t.getSkillTable=function(){return t.$SkillTable||(t.$SkillTable=t.createTable()),t.$SkillTable},t.createTable=function(){var t=RES.getRes("skills_json");return t},t.$SkillTable=t.createTable(),t}();__reflect(SkillTable.prototype,"SkillTable");var AboutScene=function(t){function e(e){var i=t.call(this)||this;return i.par=e,i.createScene(),i}return __extends(e,t),e.prototype.createScene=function(){var t=new egret.Sprite;t.graphics.beginFill(0),t.graphics.drawRect(0,0,750,1300),t.graphics.endFill(),this.addChild(t);var e=new egret.TextField,i="\n游戏名称：攻三联机版\n\n版本号：v1.0\n\n\n美术设计：粉条\n数据设计：基迈\n程序设计：糊糊（github.com/SoraShiro）\n    ";e.text=i,e.textColor=16777215,e.x=80,e.y=80,this.addChild(e),this.touchEnabled=!0,this.addEventListener("touchTap",this.finish,this,!0)},e.prototype.finish=function(){this.par.removeChild(this)},e}(egret.Sprite);__reflect(AboutScene.prototype,"AboutScene");var GameScene=function(t){function e(e,i,a){var s=t.call(this)||this;return s.hasAddMorale=!1,s.currentAtkSkill=new Skill,s.extraSkillMessage={},s._waitingResponse=!1,s.par=e,s.initData=i,s.startScene=a,s.initWebSocket(),s.createMyGameScene(),s}return __extends(e,t),Object.defineProperty(e.prototype,"upMorale",{get:function(){return this._upMorale},set:function(t){this._upMorale!==t&&(t=0>t?0:t,this._upMorale=t,this.textUpMorale.text=String(this._upMorale))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upWall",{get:function(){return this._upWall},set:function(t){this._upWall!==t&&(t=0>t?0:t,this._upWall=t,this.textUpWall.text=String(this._upWall))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"downMorale",{get:function(){return this._downMorale},set:function(t){this._downMorale!==t&&(t=0>t?0:t,this._downMorale=t,this.textDownMorale.text=String(this._downMorale))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"downWall",{get:function(){return this._downWall},set:function(t){this._downWall!==t&&(t=0>t?0:t,this._downWall=t,this.textDownWall.text=String(this._downWall))},enumerable:!0,configurable:!0}),e.prototype.createMyGameScene=function(){this.createBg(),this.createTextFields(),this.createHurtsArea(),this.createBtns(),this.createGeneralMenu(),this.createAtkSkillMenu(),this.createExtraSkillMenu(),this.createGameOverView(),this.initGameData(),this.meiStuff(),this.turnStartStuff()},e.prototype.initGameData=function(){this.playerCamp=this.initData.playerCamp,this.currentCamp=this.initData.currentCamp,this.upWall=50,this.upMorale=0,this.downWall=50,this.downMorale=0,this.operatedIndex=[],this.targetIndex=[],this.btnTurnEnd.visible=this.playerCamp===this.currentCamp},e.prototype.meiStuff=function(){for(var t=this.chessBoard.chesses,e=0;6>e;e++){var i=t[0][e];i.general&&i.general.mei&&(this.upWall+=5);var a=t[5][e];if(a.general&&a.general.mei&&(this.downWall+=5),"伪帝编制"===i.general.skill.name)for(var s=0;6>s;s++){var r=t[0][s];if(r.general){var n=r.general;n.tl+=12,r.general=n}}else if("伪帝编制"===a.general.skill.name)for(var s=0;6>s;s++){var r=t[5][s];if(r.general){var n=r.general;n.tl+=12,r.general=n}}}},e.prototype.onChessBoardTab=function(t){var e=t.stageX,i=t.stageY;if(e-=94,i-=280,e>0&&i>0){var a=e/94,s=i/95;a=Math.floor(a),s=Math.floor(s);var r=this.chessBoard.chesses[s][a],n=r.general;switch(r.status){case"normal":this.playerCamp===this.currentCamp&&(this.clearChessesStatus(),r.status="normal_confirm"),n&&(this.operatedIndex=[s,a],this.showGeneralDetail("chess"));break;case"normal_confirm":r.camp===this.playerCamp&&n&&this.playerCamp===this.currentCamp&&(this.operatedIndex=[s,a],this.showGeneralMenu());break;case"moveable":this.colorMoveStuff(),r.status="moveable_confirm";break;case"moveable_confirm":this.targetIndex=[s,a],this.requestMoveStuff();break;case"attackable":this.colorAttackStuff(),r.status="attackable_confirm";break;case"attackable_confirm":this.targetIndex=[s,a],this.requestAttackStuff();break;case"revival":r.status="revival_confirm";break;case"revival_confirm":this.targetIndex=[s,a],this.requestRevivalStuff();break;case"skillable":r.status="skill_confirm";break;case"skillable_confirm":this.targetIndex=[s,a],this.requestSkillStuff()}}},e.prototype.showGeneralMenu=function(){var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.chessBoard.chesses[t][e],a=i.general;this.moveBtn.touchEnabled=!a.hasMoved,this.moveBtn.clickable=!a.hasMoved,this.attackBtn.touchEnabled=!a.hasAttacked,this.attackBtn.clickable=!a.hasAttacked;var s=this.canAttackWall();this.attackWallBtn.touchEnabled=!a.hasAttacked&&s,this.attackWallBtn.clickable=!a.hasAttacked&&s;var r=!a.hasSkilled&&"锁定"!==a.skill.type&&!a.skill.onceUsed,n=0;1===this.playerCamp?n=this.downMorale:-1===this.playerCamp&&(n=this.upMorale),r=r&&n>=Number(a.skill.cost),"天雷"===a.skill.name?r=r&&this.checkTianLeiAvailable():"阴平奇袭"===a.skill.name&&(r=r&&this.checkYPQXAvailable()),this.skillBtn.touchEnabled=r,this.skillBtn.clickable=r,this.skillBtn.text=a.skill.name,this.generalMenu.visible=!0},e.prototype.canAttackWall=function(){var t=this.operatedIndex[0];this.operatedIndex[1];return 1===this.playerCamp&&0===t?!0:-1===this.playerCamp&&5===t?!0:!1},e.prototype.hideGeneralMenu=function(){this.generalMenu.visible=!1},e.prototype.showAtkSkillMenu=function(){this.playerCamp===this.currentCamp&&(this.atkSkillMenu.visible=!0)},e.prototype.hideAtkSkillMenu=function(){this.atkSkillMenu.visible=!1},e.prototype.clearChessesStatus=function(){for(var t=this.chessBoard.chesses,e=0,i=t.length;i>e;e++)for(var a=t[e],s=0,r=a.length;r>s;s++){var n=a[s];n.status="normal"}for(var o=this.leftChessBoard.chesses,h=this.rightChessBoard.chesses,e=0,l=o.length;l>e;e++)o[e].general&&(o[e].status=0===o[e].general.hurtTurns?"recover":"hurt"),h[e].general&&(h[e].status=0===h[e].general.hurtTurns?"recover":"hurt")},e.prototype.showGeneralDetail=function(t){var e=this.operatedIndex[0],i=this.operatedIndex[1],a=null;"chess"===t?a=this.chessBoard.chesses[e][i]:"hurted"===t&&(0===i?a=this.leftChessBoard.chesses[e]:11===i&&(a=this.rightChessBoard.chesses[e-2]));var s=a.general;if(s){var r="";"chess"===t?r="武将数据\n坐标：("+(e+1)+", "+(i+1)+")\n勇略: "+s.yl+"+"+s.extraYl+"  智谋："+s.zm+"+"+s.extraZm+"  体力："+s.tl+"\n技能："+s.skill.name+" - "+s.skill.text:"hurted"===t&&(0===i?r="武将数据\n坐标：伤兵区第 "+(4-e)+" 位\n勇略: "+s.yl+"  智谋："+s.zm+"  体力："+s.tl+"\n技能："+s.skill.name+" - "+s.skill.text:11===i&&(r="武将数据\n坐标：伤兵区第 "+(e-2)+" 位\n勇略: "+s.yl+"  智谋："+s.zm+"  体力："+s.tl+"\n技能："+s.skill.name+" - "+s.skill.text)),-1===a.camp?this.textUpDetail.text=r:this.textDownDetail.text=r}},e.prototype.hideGeneralDetail=function(t){-1===t?this.textUpDetail.text="武将数据":this.textDownDetail.text="武将数据"},e.prototype.requestColorMoveStuff=function(){if(!this._waitingResponse){this.requestWaitStart();var t=JSON.stringify({reqStr:"postData",action:"colorMoveable",operatedIndex:this.operatedIndex,targetIndex:this.targetIndex});this.socket.writeUTF(t)}},e.prototype.beginColorMoveStuff=function(){this.hideGeneralMenu(),this.colorMoveStuff()},e.prototype.colorMoveStuff=function(){var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.chessBoard.chesses[t][e],a=i.general;i.status="mover";var s=a.armsInfo,r=s.moveStep,n=r+a.extraMoveStep;this.colorMoveableChess(n,t,e,null,s.ifStraight,a.canPenetrate)},e.prototype.colorMoveableChess=function(t,e,i,a,s,r){if(!(0>=t)){var n=this.chessBoard.chesses;e+1<n.length&&(0===n[e+1][i].camp?s&&"down"!==a&&a||(n[e+1][i].status="moveable",this.colorMoveableChess(t-1,e+1,i,"down",s,r)):n[e+1][i].camp!==this.playerCamp&&r&&this.colorMoveableChess(t-1,e+1,i,"down",s,r)),e-1>=0&&(0===n[e-1][i].camp?s&&"up"!==a&&a||(n[e-1][i].status="moveable",this.colorMoveableChess(t-1,e-1,i,"up",s,r)):n[e-1][i].camp!==this.playerCamp&&r&&this.colorMoveableChess(t-1,e-1,i,"up",s,r)),i+1<n[0].length&&(0===n[e][i+1].camp?s&&"right"!==a&&a||(n[e][i+1].status="moveable",this.colorMoveableChess(t-1,e,i+1,"right",s,r)):n[e][i+1].camp!==this.playerCamp&&r&&this.colorMoveableChess(t-1,e,i+1,"right",s,r)),i-1>=0&&(0===n[e][i-1].camp?s&&"left"!==a&&a||(n[e][i-1].status="moveable",this.colorMoveableChess(t-1,e,i-1,"left",s,r)):n[e][i-1].camp!==this.playerCamp&&r&&this.colorMoveableChess(t-1,e,i-1,"left",s,r))}},e.prototype.requestMoveStuff=function(){if(!this._waitingResponse){this.requestWaitStart();var t=JSON.stringify({reqStr:"postData",action:"moveGeneral",operatedIndex:this.operatedIndex,targetIndex:this.targetIndex});this.socket.writeUTF(t)}},e.prototype.operateMoveStuff=function(){var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.targetIndex[0],a=this.targetIndex[1];if(t!==i||e!==a){var s=Math.abs(e-a),r=Math.abs(t-i),n=s+r,o=this.chessBoard.chesses[t][e],h=o.general;h.usedMoveStep=n,h.hasMoved=!0;var l=this.chessBoard.chesses[i][a],c=l.general;c||(l.general=h,o.general=null,l.camp=o.camp,o.camp=0,this.clearChessesStatus())}},e.prototype.requestColorAttackStuff=function(){if(!this._waitingResponse){this.requestWaitStart();var t=JSON.stringify({reqStr:"postData",action:"colorAttackable",operatedIndex:this.operatedIndex,targetIndex:this.targetIndex});this.socket.writeUTF(t)}},e.prototype.beginColorAttackStuff=function(){this.hideGeneralMenu(),this.colorAttackStuff()},e.prototype.colorAttackStuff=function(){var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.chessBoard.chesses[t][e],a=i.general;i.status="attacker";var s=a.armsInfo,r=s.attackRange,n=r+a.extraAtkRange;a.extraMessage.attackTarget?this.colorAttackTarget(a.extraMessage.attackTarget):a.untilDieMessage["天弓"]?this.colorAllAtkableChess():this.colorAttackableChess(n,t,e)},e.prototype.colorAttackTarget=function(t){for(var e=this.operatedIndex[0],i=this.operatedIndex[1],a=this.chessBoard.chesses,s=a[e][i].camp,r=1===s?-1:1,n=0;6>n;n++)for(var o=0;6>o;o++){var h=a[n][o],l=h.camp;l===r&&h.general===t&&(h[n][o].status="attackable")}},e.prototype.colorChesses=function(t,e,i,a){if(!(0>=t)){var s=this.chessBoard.chesses;e+1<s.length&&(s[e+1][i].camp!==this.playerCamp&&(s[e+1][i].status=a),this.colorAttackableChess(t-1,e+1,i)),e-1>=0&&(s[e-1][i].camp!==this.playerCamp&&(s[e-1][i].status=a),this.colorAttackableChess(t-1,e-1,i)),i+1<s[0].length&&(s[e][i+1].camp!==this.playerCamp&&(s[e][i+1].status=a),this.colorAttackableChess(t-1,e,i+1)),i-1>=0&&(s[e][i-1].camp!==this.playerCamp&&(s[e][i-1].status=a),this.colorAttackableChess(t-1,e,i-1))}},e.prototype.colorAttackableChess=function(t,e,i){this.colorChesses(t,e,i,"attackable")},e.prototype.colorNormalSkillableChess=function(t,e,i){this.colorChesses(t,e,i,"skillable")},e.prototype.colorAllAtkableChess=function(){for(var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.chessBoard.chesses,a=i[t][e].camp,s=1===a?-1:1,r=0;6>r;r++)for(var n=0;6>n;n++){var o=i[r][n],h=o.camp;h===s&&(o[r][n].status="attackable")}},e.prototype.requestAttackStuff=function(){if(!this._waitingResponse){this.requestWaitStart();
var t=JSON.stringify({reqStr:"postData",action:"attackGeneral",operatedIndex:this.operatedIndex,targetIndex:this.targetIndex,atkSkill:this.currentAtkSkill});this.socket.writeUTF(t)}},e.prototype.operateAttackStuff=function(){var t=this.targetIndex[0],e=this.targetIndex[1],i=this.operatedIndex[0],a=this.operatedIndex[1],s=this.chessBoard.chesses[t][e],r=s.general;if(r){var n=this.chessBoard.chesses[i][a],o=n.general;if(o.hasAttacked=!0,"天下无双"===o.skill.name&&r.yl+r.extraYl<=4)return r.tl=0,s.general=r,this.checkAlive(t,e),void this.clearChessesStatus();var h=0;if("壮士断腕"===o.skill.name&&o.hasSkilled)for(var l=i-1;i+1>=l;l++){for(var c=a-1;a+1>=c;c++){var u=this.chessBoard.chesses[l][c],d=u.camp;if(d===-n.camp){var p=o.yl,g=p+o.extraYl,f=(r.tl,g),x=u.general;x.tl-=f,u.general=x,this.checkAlive(l,c)}}return}if("No"===this.currentAtkSkill.name&&!this.atkSkillMenu.visible){var b=Utils.is2dAdjacent(i,a,t,e);if(b&&o.yong)return void this.showAtkSkillMenu()}var m=o.yl,y=m+o.extraYl,v=r.tl;h+=y;var k=0;if(o.fu){var C=o.zm-r.zm;0>C&&(C=0),C*=2,C+=3,k+=C,o.fu=!1,n.general=o}if(o.extraMessage["伏兵"]){var C=o.zm-r.zm;0>C&&(C=0),C*=3,C+=10,k+=C}if(o.extraMessage["武侯军阵"]){var C=o.zm-r.zm;0>C&&(C=0),k+=C}if(o.extraMessage.extraDamage&&(h+=o.extraMessage.extraDamage),"小霸王"===o.skill.name){var C=o.zm-r.zm;0>C&&(C=0),k+=C}if(o.extraMessage.extraDamageToQiBin&&"骑"===r.arms&&(h+=5),"弑君"===o.skill.name){var S=r.cost;h+=S}if("以逸待劳"===o.skill.name){var T=o.extraMoveStep+o.armsInfo.moveStep-o.usedMoveStep;h+=3*T}if(o.extraMessage["势如破竹"]){var C=o.tl;k+=C}o.extraMessage["苦肉"]&&this.isNeighbor(i,a,t,e)&&(h+=o.extraMessage["苦肉"]);var _=v-(h+k);0>_&&(_=0),r.tl=_,s.general=r;var w=this.checkAlive(t,e);if("No"!==this.currentAtkSkill.name)switch(this.currentAtkSkill.name){case"勇":if(w){var B=t-i,E=e-a,L=t+B,M=e+E;0>L&&(L=0),L>5&&(L=5),0>M&&(M=0),M>5&&(M=5),this.operatedIndex=[t,e],this.targetIndex=[L,M],this.operateMoveStuff(),o.yong=!1,n.general=o}}this.currentAtkSkill=new Skill,this.clearChessesStatus()}},e.prototype.isNeighbor=function(t,e,i,a){var s=!1;return t===i&&e===a-1?s=!0:t===i&&e===a+1?s=!0:t===i-1&&e===a?s=!0:t===i+1&&e===a&&(s=!0),s},e.prototype.operateAtkSkillCancel=function(){this.currentAtkSkill=new Skill(SkillTable.getSkillTable().noUsed),this.operateAtkSkill()},e.prototype.operateAtkSkillYong=function(){this.currentAtkSkill=new Skill(SkillTable.getSkillTable()["勇"]),this.operateAtkSkill()},e.prototype.operateAtkSkill=function(){this.hideAtkSkillMenu(),this.requestAttackStuff()},e.prototype.colorFriendSkillableStuff=function(t){void 0===t&&(t=!0);for(var e=this.operatedIndex[0],i=this.operatedIndex[1],a=this.chessBoard.chesses,s=a[e][i].camp,r=0;6>r;r++)for(var n=0;6>n;n++)if(r!==e||n!==i||t){var o=a[r][n],h=o.camp;h===s&&(o[r][n].status="skillable")}},e.prototype.checkAlive=function(t,e,i){void 0===i&&(i=!0);var a=this.chessBoard.chesses[t][e],s=a.general;if(s.tl<=0){"伪帝编制"===s.skill.name&&this.operateGameOverStuff(-a.camp),s.fu=!1,s.hurtTurns=3,s.extraMessage.addHurtTurns&&(s.hurtTurns+=s.extraMessage.addHurtTurns),s.extraYl=0,s.extraZm=0,s.extraAtkRange=0,s.extraMoveStep=0,s.canPenetrate=!1,s.extraMessage={},s.untilDieMessage={};var r=null;if(1===a.camp){r=this.rightChessBoard;for(var n=0;4>n;n++){var o=r.chesses[n];if(!o.general){o.general=s,a.general=null,a.camp=0;break}}}else{r=this.leftChessBoard;for(var h=3;h>=0;h--){var o=r.chesses[h];if(!o.general){o.general=s,a.general=null,a.camp=0;break}}}if(i&&!this.hasAddMorale){var l=this.currentCamp;1===l?this.downMorale+=1:-1===l&&(this.upMorale+=1),this.hasAddMorale=!0}return!1}return!0},e.prototype.requestColorRevivalStuff=function(){if(!this._waitingResponse){this.requestWaitStart();var t=JSON.stringify({reqStr:"postData",action:"colorRevival",operatedIndex:this.operatedIndex,targetIndex:this.targetIndex});this.socket.writeUTF(t)}},e.prototype.onHurtsAreaTab=function(t){var e=t.stageX,i=t.stageY,a=e-17,s=i-299;if(a>0&&s>0){var r=a/60,n=s/87;r=Math.floor(r),n=Math.floor(n);var o=null;if(0===r?o=this.leftChessBoard.chesses[n]:11===r&&(o=this.rightChessBoard.chesses[n-2]),o.general)switch(o.status){case"hurt":this.clearChessesStatus(),this.operatedIndex=[n,r],this.showGeneralDetail("hurted"),o.status="hurt_confirm";break;case"hurt_confirm":this.clearChessesStatus(),o.status="hurt";break;case"recover":this.clearChessesStatus(),this.operatedIndex=[n,r],this.playerCamp===this.currentCamp&&(this.requestColorRevivalStuff(),o.status="recover_confirm"),this.showGeneralDetail("hurted");break;case"recover_confirm":this.clearChessesStatus(),o.status="recover"}else this.clearChessesStatus()}},e.prototype.colorRevivalStuff=function(){var t=this.operatedIndex[0],e=this.operatedIndex[1];if(0===e&&-1===this.playerCamp)for(var i=(this.leftChessBoard.chesses[t],this.chessBoard.chesses),a=0,s=i[0].length;s>a;a++){var r=i[0][a];0===r.camp&&(r.status="revival")}else if(11===e&&1===this.playerCamp)for(var i=(this.rightChessBoard.chesses[t-2],this.chessBoard.chesses),a=0,s=i[5].length;s>a;a++){var r=i[5][a];0===r.camp&&(r.status="revival")}},e.prototype.requestRevivalStuff=function(){if(!this._waitingResponse){this.requestWaitStart();var t=JSON.stringify({reqStr:"postData",action:"revivalGeneral",operatedIndex:this.operatedIndex,targetIndex:this.targetIndex});this.socket.writeUTF(t)}},e.prototype.operateRevivalStuff=function(){var t=this.operatedIndex[0],e=this.operatedIndex[1],i=null;0===e?i=this.leftChessBoard.chesses[t]:11===e&&(i=this.rightChessBoard.chesses[t-2]);var a=i.general,s=this.targetIndex[0],r=this.targetIndex[1],n=this.chessBoard.chesses[s][r];a.tl=a.maxTl,a.hasMoved=!1,a.hasAttacked=!1,n.general=a,i.general=null,n.camp=i.camp,this.clearChessesStatus()},e.prototype.requestAtkWallStuff=function(){if(!this._waitingResponse){this.requestWaitStart();var t=JSON.stringify({reqStr:"postData",action:"atkWall",operatedIndex:this.operatedIndex,targetIndex:this.targetIndex});this.socket.writeUTF(t)}},e.prototype.operateAtkWallStuff=function(){var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.chessBoard.chesses[t][e],a=i.general,s=a.yl+a.extraYl;"器"===a.arms&&(s+=10),"陷阵营"===a.skill.name&&(s+=7),a.extraMessage.atkWall&&(s+=a.extraMessage.atkWall);var r=s;if(0===t){var n=this.upWall-r;this.upWall=0>n?0:n}else if(5===t){var n=this.downWall-r;this.downWall=0>n?0:n}this.checkWallAlive()},e.prototype.checkWallAlive=function(){0===this.upWall?this.operateGameOverStuff(1):0===this.downWall&&this.operateGameOverStuff(-1)},e.prototype.requestSkillStuff=function(){if(!this._waitingResponse){this.requestWaitStart();var t=this.targetIndex[0],e=this.targetIndex[1],i=this.operatedIndex[0],a=this.operatedIndex[1],s=this.chessBoard.chesses[i][a],r=s.general,n=this.chessBoard.chesses[t][e],o=(n.general,r.skill);if(!this.extraSkillMessage.name)switch(this.extraSkillMessage.name=o.name,o.name){case"落石":return void this.showExtraSkillMenu("落石");case"火烧赤壁":return void this.showExtraSkillMenu("火烧赤壁");case"发明":return void this.colorFriendSkillableStuff(!1);case"黄天当立":return void this.colorNormalSkillableChess(2,i,a)}var h=JSON.stringify({reqStr:"postData",action:"skill",operatedIndex:this.operatedIndex,targetIndex:this.targetIndex,extraSkillMessage:this.extraSkillMessage});this.socket.writeUTF(h)}},e.prototype.operateSkillStuff=function(){var t=this.targetIndex[0],e=this.targetIndex[1],i=this.operatedIndex[0],a=this.operatedIndex[1],s=this.chessBoard.chesses[i][a],r=s.general,n=this.chessBoard.chesses[t][e],o=n.general,h=s.camp,l=r.skill;if(h===this.currentCamp){1===h?this.downMorale-=Number(l.cost):-1===h&&(this.upMorale-=Number(l.cost));var c=1===h?this.downWall:this.upWall,u="";switch(l.name){case"魏武挥鞭":this.changeExtraToGenerals(h,"all",6,0,0,1,{});break;case"虎豹突击":this.changeExtraToGenerals(h,"骑",1,0,1,0,{});break;case"虎豹骑":break;case"伏兵":r.extraMessage["伏兵"]=!0;break;case"武侯军阵":this.changeExtraToGenerals(h,"all",0,0,0,0,{"武侯军阵":!0,addTl:10});break;case"单骑救主":r.extraMoveStep+=2,r.extraYl+=4,r.canPenetrate=!0;break;case"无当飞军":break;case"落石":u=this.extraSkillMessage.btnText,this.operateLuoShiSkill(u);break;case"火烧赤壁":u=this.extraSkillMessage.btnText,this.operateHSCBSkill(u);break;case"天弓":r.untilDieMessage["天弓"]=r.untilDieMessage["天弓"]||{times:0},r.untilDieMessage["天弓"].times++,r.extraYl+=4;break;case"丹阳卫":break;case"弓腰之乐":r.untilDieMessage["弓腰之乐"]=r.untilDieMessage["弓腰之乐"]||{times:0},r.untilDieMessage["弓腰之乐"].times++,this.changeExtraToGenerals(h,"弓",2,0,0,0,{});break;case"天下无双":break;case"暴虐突击":this.changeExtraToGenerals(h,"all",8,0,0,0,{decreaseTl:5});break;case"陷阵营":break;case"天雷":this.operateTianLeiSkill();break;case"晋宣军略":c+=10,this.changeExtraToGenerals(h,"all",0,0,0,1,{atkWall:10});break;case"景王权术":this.changeExtraToGenerals(h,"all",3,0,0,0,{}),this.changeExtraToGenerals(-h,"all",0,0,0,0,{addHurtTurns:1});break;case"阴平奇袭":this.operateYPQXSkill(),r.skill.onceUsed=!0;break;case"三分归晋":this.operateGameOverStuff(h);break;case"万弩齐张":r.extraYl+=8,r.extraAtkRange+=1,r.extraMessage.extraDamageToQiBin?r.extraMessage.extraDamageToQiBin+=5:r.extraMessage.extraDamageToQiBin=5,this.changeExtraToGenerals(-h,"all",0,0,0,0,{addHurtTurns:1});break;case"争功":o.hasMoved=!0,o.hasAttacked=!0,o.hasSkilled=!0,r.extraYl+=o.yl+o.extraYl,r.extraMoveStep+=o.armsInfo.moveStep+o.extraMoveStep;break;case"发明":var d=o.arms,p=ArmsInfo.getArmsInfoByName(d,o.yl);o.arms="器",o.armsInfo=ArmsInfo.getArmsInfoByName("器",o.yl),o.armsInfo.maxTl=p.maxTl,n.general=o;break;case"昭心若揭":this.changeExtraToGenerals(h,"all",3,0,0,0,{}),r.tl+=10,this.changeExtraToGenerals(-h,"all",0,0,0,0,{attackTarget:s.general});break;case"势如破竹":r.extraMessage["势如破竹"]=!0;break;case"黄天当立":o.tl-=999,o.tl<0&&(o.tl=0),n.general=o,this.checkAlive(t,e);break;case"壮士断腕":r.extraYl+=8,s.general=r;break;case"苦肉":var g=r.tl;r.tl=1,r.extraMessage["苦肉"]=g-1,s.general=r;break;case"弓兵齐射":this.changeExtraToGenerals(h,"弓",2,0,1,0,{});break;case"夷陵烽火":this.operateYLFHSkill(i,a)}r.hasSkilled=!0,s.general=r,this.extraSkillMessage={},this.clearChessesStatus()}},e.prototype.operateYLFHSkill=function(t,e){for(var i=this.chessBoard.chesses,a=i[t][e],s=a.general,r=a.camp,n=-r,o=s.zm+s.extraZm,h=0;h<i.length;h++)for(var l=0;l<i[h].length;l++){var c=i[h][l];if(c.camp===n){var u=c.general,d=u.zm+u.extraZm,p=o-d;0>p&&(p=0);for(var g=!1,f=h-1;h+1>=f;f++){for(var x=l-1;l+1>=x;x++){var b=i[f][x];if(b.camp===n){g=!0;break}}if(g)break}g&&(p+=10),u.tl-=p,this.checkAlive(h,l)}}},e.prototype.operateYPQXSkill=function(){for(var t=this.operatedIndex[0],e=this.operatedIndex[1],i=(this.chessBoard.chesses[t][e],this.chessBoard.chesses),a=-i[t][e].camp,s=1===a?5:0,r=0;6>r;r++)0===i[s][r].camp&&(i[s][r].status="moveable")},e.prototype.checkYPQXAvailable=function(){for(var t=this.operatedIndex[0],e=this.operatedIndex[1],i=(this.chessBoard.chesses[t][e],this.chessBoard.chesses),a=-i[t][e].camp,s=1===a?5:0,r=0;6>r;r++)if(0===i[s][r].camp)return!0;return!1},e.prototype.operateTianLeiSkill=function(){for(var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.chessBoard.chesses,a=i[t][e].general,s=i[t][e].camp,r=1===s?-1:1,n=[],o=0;6>o;o++)i[o][e].camp===r&&n.push({i:o,j:e});for(var h=0;6>h;h++)i[t][h].camp===r&&n.push({i:t,j:h});if(1===n.length){var l=n[0].i,c=n[0].j,u=i[l][c],d=u.general,p=a.zm-d.zm;0>p&&(p=0),p*=2,p+=15;var g=d.tl-p;a.extraMessage.extraDamage&&(g-=a.extraMessage.extraDamage),g=0>g?0:g,d.tl=g,u.general=d,this.checkAlive(n[0].i,n[0].j)}else for(var f=0;f<n.length;f++){var l=n[f].i,c=n[f].j,u=i[l][c],d=u.general,p=a.zm-d.zm;0>p&&(p=0),p*=2,p+=10;var g=d.tl-p;a.extraMessage.extraDamage&&(g-=a.extraMessage.extraDamage),g=0>g?0:g,d.tl=g,u.general=d,this.checkAlive(n[f].i,n[f].j)}},e.prototype.checkTianLeiAvailable=function(){for(var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.chessBoard.chesses,a=(i[t][e].general,i[t][e].camp),s=1===a?-1:1,r=0;6>r;r++)if(i[r][e].camp===s)return!0;for(var n=0;6>n;n++)if(i[t][n].camp===s)return!0;return!1},e.prototype.operateHSCBSkill=function(t){var e=this.operatedIndex[0],i=this.operatedIndex[1],a=this.chessBoard.chesses,s=a[e][i].general,r=a[e][i].camp,n=1===r?-1:1,o=[];switch(t){case"北半场":for(var h=0;3>h;h++)for(var l=0;6>l;l++){var c=a[h][l].camp;c===n&&o.push({i:h,j:l})}break;case"南半场":for(var h=3;6>h;h++)for(var l=0;6>l;l++){var c=a[h][l].camp;c===n&&o.push({i:h,j:l})}}for(var u=0;u<o.length;u++){var d=o[u].i,p=o[u].j,g=a[d][p],f=g.general,x=s.zm-f.zm;0>x&&(x=0),x*=3,x+=5;var b=f.tl-x;s.extraMessage.extraDamage&&(b-=s.extraMessage.extraDamage),b=0>b?0:b,f.tl=b,g.general=f,this.checkAlive(o[u].i,o[u].j)}},e.prototype.checkHSCBAvailable=function(){for(var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.chessBoard.chesses,a=i[t][e].camp,s=1===a?-1:1,r=[],n=0;3>n;n++){for(var o=0;6>o;o++){var h=i[n][o].camp;if(h===s){r.push(!0);break}}if(1===r.length)break}0===r.length&&r.push(!1);for(var n=3;6>n;n++){for(var o=0;6>o;o++){var h=i[n][o].camp;if(h===s){r.push(!0);break}}if(2===r.length)break}return 1===r.length&&r.push(!1),r},e.prototype.operateLuoShiSkill=function(t){var e=this.operatedIndex[0],i=this.operatedIndex[1],a=this.chessBoard.chesses,s=a[e][i].general,r=a[e][i].camp,n=1===r?-1:1,o=[];switch(t){case"北方":for(var h=-1;h>=-3&&e+h>=0;h--){var l=a[e+h][i];if(l.camp===n&&o.push({i:e+h,j:i}),i-1>=0){var c=a[e+h][i-1];c.camp===n&&o.push({i:e+h,j:i-1})}if(6>i+1){var u=a[e+h][i+1];u.camp===n&&o.push({i:e+h,j:i+1})}}break;case"南方":for(var h=1;3>=h&&6>e+h;h++){var l=a[e+h][i];if(l.camp===n&&o.push({i:e+h,j:i}),i-1>=0){var c=a[e+h][i-1];c.camp===n&&o.push({i:e+h,j:i-1})}if(6>i+1){var u=a[e+h][i+1];u.camp===n&&o.push({i:e+h,j:i+1})}}break;case"东方":for(var h=1;3>=h&&6>i+h;h++){var l=a[e][i+h];if(l.camp===n&&o.push({i:e,j:i+h}),e-1>=0){var d=a[e-1][i+h];d.camp===n&&o.push({i:e-1,j:i+h})}if(6>e+1){var p=a[e+1][i+h];p.camp===n&&o.push({i:e+1,j:i+h})}}break;case"西方":for(var h=-1;h>=-3&&i+h>=0;h--){var l=a[e][i+h];if(l.camp===n&&o.push({i:e,j:i+h}),e-1>=0){var d=a[e-1][i+h];d.camp===n&&o.push({i:e-1,j:i+h})}if(6>e+1){var p=a[e+1][i+h];p.camp===n&&o.push({i:e+1,j:i+h})}}}for(var g=0;g<o.length;g++){var f=o[g].i,x=o[g].j,b=a[f][x],m=b.general,y=s.zm-m.zm;0>y&&(y=0),y*=2,y+=10;var v=m.tl-y;s.extraMessage.extraDamage&&(v-=s.extraMessage.extraDamage),v=0>v?0:v,m.tl=v,b.general=m,this.checkAlive(o[g].i,o[g].j)}},e.prototype.checkLuoShiAvailable=function(){for(var t=this.operatedIndex[0],e=this.operatedIndex[1],i=this.chessBoard.chesses,a=i[t][e].camp,s=1===a?-1:1,r=[],n=-1;n>=-3&&t+n>=0;n--){var o=i[t+n][e];if(o.camp===s){r.push(!0);break}if(e-1>=0){var h=i[t+n][e-1];if(h.camp===s){r.push(!0);break}}if(6>e+1){var l=i[t+n][e+1];if(l.camp===s){r.push(!0);break}}}0===r.length&&r.push(!1);for(var n=1;3>=n&&6>t+n;n++){var o=i[t+n][e];if(o.camp===s){r.push(!0);break}if(e-1>=0){var h=i[t+n][e-1];if(h.camp===s){r.push(!0);break}}if(6>e+1){var l=i[t+n][e+1];if(l.camp===s){r.push(!0);break}}}1===r.length&&r.push(!1);for(var n=1;3>=n&&6>e+n;n++){var o=i[t][e+n];if(o.camp===s){r.push(!0);break}if(t-1>=0){var c=i[t-1][e+n];if(c.camp===s){r.push(!0);break}}if(6>t+1){var u=i[t+1][e+n];if(u.camp===s){r.push(!0);break}}}2===r.length&&r.push(!1);for(var n=-1;n>=-3&&e+n>=0;n--){var o=i[t][e+n];if(o.camp===s){r.push(!0);break}if(t-1>=0){var c=i[t-1][e+n];if(c.camp===s){r.push(!0);break}}if(6>t+1){var u=i[t+1][e+n];if(u.camp===s){r.push(!0);break}}}return 3===r.length&&r.push(!1),r},e.prototype.changeExtraToGenerals=function(t,e,i,a,s,r,n){for(var o=this.chessBoard.chesses,h=0;6>h;h++)for(var l=0;6>l;l++){var c=o[h][l];if(c.camp===t){var u=c.general,d=u.arms;if("all"===e||e===d){u.extraYl+=i,u.extraZm+=a,u.extraAtkRange+=s,u.extraMoveStep+=r;for(var p in n)switch(p){case"addTl":u.tl+=n[p];break;case"decreaseTl":u.tl-=n[p];default:p in u.extraMessage?u.extraMessage[p]+=n[p]:u.extraMessage[p]=n[p]}c.general=u,this.checkAlive(h,l,!1)}}}},e.prototype.operateGameOverStuff=function(t){1===t?this.gameOverText.text="南方胜利":this.gameOverText.text="北方胜利",this.gameOverView.visible=!0},e.prototype.operateFinishGameStuff=function(){this.gameOverText.text="请重启游戏"},e.prototype.requestTurnEndStuff=function(){if(this.btnTurnEnd.visible=!1,this.socket&&this.socket.connected){var t=JSON.stringify({reqStr:"postData",action:"turnEnd",operatedIndex:this.operatedIndex,targetIndex:this.targetIndex});this.socket.writeUTF(t)}else this.beginTurnEndStuff(this.currentCamp),this.beginTurnStartStuff(-this.currentCamp)},e.prototype.beginTurnStartStuff=function(t){this.currentCamp=t,this.turnStartStuff()},e.prototype.beginTurnEndStuff=function(t){this.currentCamp=t,this.turnEndStuff()},e.prototype.turnStartStuff=function(){var t=null;t=1===this.currentCamp?this.rightChessBoard.chesses:this.leftChessBoard.chesses;for(var e=0,i=t.length;i>e;e++){var a=t[e],s=a.general;s&&(s.hurtTurns=0===s.hurtTurns?0:s.hurtTurns-1,a.general=s)}for(var r=!1,e=0;6>e;e++)for(var n=0;6>n;n++){var a=this.chessBoard.chesses[e][n];if(a.camp===this.currentCamp){var s=a.general;switch(s.skill.name){case"魏之元勋":this.changeExtraToGenerals(this.currentCamp,"all",0,0,0,0,{extraDamage:4});break;case"武圣军魂":this.changeExtraToGenerals(this.currentCamp,"all",0,0,0,1,{});break;case"争功":r=!0;break;case"恃勇":s.tl-=3,a.general=s,this.checkAlive(e,n,!1);break;case"白马义从":s.extraAtkRange+=2,a.general=s}}else if(a.general){var s=a.general;switch(s.skill.name){case"倾国之色":this.changeExtraToGenerals(-this.currentCamp,"all",0,-1,0,0,{})}}}-1===this.currentCamp?this.upMorale++:this.downMorale++,this.hasAddMorale=!1,this.playerCamp===this.currentCamp&&(this.btnTurnEnd.visible=!0),r&&this.colorFriendSkillableStuff()},e.prototype.turnEndStuff=function(){this.clearChessesStatus();for(var t=0;6>t;t++)for(var e=0;6>e;e++){var i=this.chessBoard.chesses[t][e],a=i.general;if(a&&i.camp===this.currentCamp){a.extraYl=0,a.extraZm=0,a.extraMoveStep=0,a.extraAtkRange=0,a.hasMoved=!1,a.hasAttacked=!1,a.hasSkilled=!1,a.canPenetrate=!1,a.usedMoveStep=0,a.extraMessage={};var s=a.untilDieMessage;s["天弓"]&&(a.extraYl+=4*s["天弓"].times),s["弓腰之乐"]&&this.changeExtraToGenerals(i.camp,"弓",2*s["弓腰之乐"].times,0,0,0,{}),"壮士断腕"===a.skill.name&&a.hasSkilled&&(a.tl=0,this.checkAlive(t,e,!1)),i.general=a}}},e.prototype.createBg=function(){var t=new egret.Bitmap(RES.getRes("bg_jpg"));this.addChild(t),this.chessBoard=new ChessBoard(this.getChesses()),this.chessBoard.x=94,this.chessBoard.y=280;for(var e=0;6>e;e++)for(var i=0;6>i;i++){var a=this.chessBoard.chesses[e][i];a.touchEnabled=!0,a.addEventListener("touchTap",this.onChessBoardTab,this)}this.addChild(this.chessBoard);var s=new egret.Bitmap(RES.getRes("chessboard_part_cutter_png"));s.x=91,s.y=277,this.addChild(s);var r=new egret.Bitmap(RES.getRes("hurts_area_png"));r.x=0,r.y=230,this.addChild(r);var n=new egret.Bitmap(RES.getRes("hurts_area_part_png"));n.x=17,n.y=299,this.addChild(n);var o=new egret.Bitmap(RES.getRes("power_bg_png"));this.addChild(o);var h=new egret.Bitmap(RES.getRes("turns_bg_png"));h.anchorOffsetY=75,h.y=1200,this.addChild(h);var l=new egret.Bitmap(RES.getRes("wall_morale_text_png"));l.x=15,l.y=80,this.addChild(l)},e.prototype.getChesses=function(){return this.initData.chesses},e.prototype.createHurtsArea=function(){for(var t=[],e=0;4>e;e++){var i=this.initData.leftChesses[e];i.addEventListener("touchTap",this.onHurtsAreaTab,this),i.camp=-1,t.push(i)}this.leftChessBoard=new HurtedChessBoard(this,t),this.leftChessBoard.x=17,this.leftChessBoard.y=299,this.leftChessBoard.layoutBgColorAlpha=0,this.leftChessBoard.layoutSpacing=2,this.addChild(this.leftChessBoard);for(var a=[],e=0;4>e;e++){var i=this.initData.rightChesses[e];i.addEventListener("touchTap",this.onHurtsAreaTab,this),i.camp=1,a.push(i)}this.rightChessBoard=new HurtedChessBoard(this,a),this.rightChessBoard.x=674,this.rightChessBoard.y=473,this.rightChessBoard.layoutBgColorAlpha=0,this.rightChessBoard.layoutSpacing=2,this.addChild(this.rightChessBoard)},e.prototype.createTextFields=function(){this.textUpPower=new egret.TextField,this.textUpPower.text=this.initData.upPower,this.textUpPower.x=33,this.textUpPower.y=20,this.textUpPower.fontFamily="KaiTi",this.addChild(this.textUpPower);var t=114,e=34,i=-5;this.textUpWall=new egret.TextField,this.textUpWall.text="30",this.textUpWall.x=t,this.textUpWall.y=86+i,this.textUpWall.size=e,this.textUpWall.fontFamily="KaiTi",this.addChild(this.textUpWall),this.textUpMorale=new egret.TextField,this.textUpMorale.text="0",this.textUpMorale.x=t,this.textUpMorale.y=130+i,this.textUpMorale.size=e,this.textUpMorale.fontFamily="KaiTi",this.addChild(this.textUpMorale),this.textUpDetail=new egret.TextField,this.textUpDetail.text="武将数据",this.textUpDetail.x=190,this.textUpDetail.y=10,this.textUpDetail.width=550,this.textUpDetail.height=190,this.textUpDetail.fontFamily="KaiTi",this.addChild(this.textUpDetail),this.textDownPower=new egret.TextField,this.textDownPower.text=this.initData.downPower,this.textDownPower.x=33,this.textDownPower.y=930,this.textDownPower.fontFamily="KaiTi",this.addChild(this.textDownPower),this.textDownWall=new egret.TextField,this.textDownWall.text="30",this.textDownWall.x=t,this.textDownWall.y=996+i,this.textDownWall.size=e,this.textDownWall.fontFamily="KaiTi",this.addChild(this.textDownWall),this.textDownMorale=new egret.TextField,this.textDownMorale.text="0",this.textDownMorale.x=t,this.textDownMorale.y=1039+i,this.textDownMorale.size=e,this.textDownMorale.fontFamily="KaiTi",this.addChild(this.textDownMorale),this.textDownDetail=new egret.TextField,this.textDownDetail.text="武将数据",this.textDownDetail.x=190,this.textDownDetail.y=955,this.textDownDetail.width=550,this.textDownDetail.height=190,this.textDownDetail.fontFamily="KaiTi",this.addChild(this.textDownDetail)},e.prototype.createBtns=function(){var t=new egret.Bitmap(RES.getRes("btn_turnover_png"));this.btnTurnEnd=new ImgBtn(this,143,52),this.btnTurnEnd.img=t,this.btnTurnEnd.anchorOffsetX=143,this.btnTurnEnd.anchorOffsetY=52,this.btnTurnEnd.x=746,this.btnTurnEnd.y=1194,this.btnTurnEnd.btnBgColorAlpha=0,this.btnTurnEnd.addEventListener("touchTap",this.requestTurnEndStuff,this),this.addChild(this.btnTurnEnd)},e.prototype.createGeneralMenu=function(){this.generalMenu=new VerticalLayout(this),this.moveBtn=new ImgBtn(this),this.moveBtn.text="移动",this.moveBtn.addEventListener("touchTap",this.requestColorMoveStuff,this),this.attackBtn=new ImgBtn(this),this.attackBtn.text="攻击",this.attackBtn.addEventListener("touchTap",this.requestColorAttackStuff,this),this.skillBtn=new ImgBtn(this),this.skillBtn.text="技能",this.skillBtn.addEventListener("touchTap",this.requestSkillStuff,this),this.attackWallBtn=new ImgBtn(this),this.attackWallBtn.text="攻击城墙",this.attackWallBtn.addEventListener("touchTap",this.requestAtkWallStuff,this),this.cancelBtn=new ImgBtn(this),this.cancelBtn.text="取消",this.cancelBtn.addEventListener("touchTap",this.hideGeneralMenu,this),this.generalMenu.x=86,this.generalMenu.y=277,this.generalMenu.layoutPaddingLeft=43,this.generalMenu.layoutPaddingTop=53,this.generalMenu.layoutBgColorAlpha=.5,this.generalMenu.addLayoutChild(this.moveBtn),this.generalMenu.addLayoutChild(this.attackBtn),this.generalMenu.addLayoutChild(this.skillBtn),this.generalMenu.addLayoutChild(this.attackWallBtn),this.generalMenu.addLayoutChild(this.cancelBtn),this.generalMenu.touchEnabled=!0,this.generalMenu.addEventListener("touchTap",this.hideGeneralMenu,this,!0),this.generalMenu.visible=!1,this.addChild(this.generalMenu)},e.prototype.createAtkSkillMenu=function(){this.atkSkillMenu=new VerticalLayout(this),this.skillCancelBtn=new ImgBtn(this),this.skillCancelBtn.text="不使用",this.skillCancelBtn.addEventListener("touchTap",this.operateAtkSkillCancel,this),this.skillOneBtn=new ImgBtn(this),this.skillOneBtn.text="勇",this.skillOneBtn.addEventListener("touchTap",this.operateAtkSkillYong,this),this.atkSkillMenu.x=86,this.atkSkillMenu.y=277,this.atkSkillMenu.layoutPaddingLeft=43,this.atkSkillMenu.layoutPaddingTop=53,this.atkSkillMenu.layoutBgColorAlpha=.5,this.atkSkillMenu.addLayoutChild(this.skillCancelBtn),this.atkSkillMenu.addLayoutChild(this.skillOneBtn),this.atkSkillMenu.touchEnabled=!0,this.atkSkillMenu.addEventListener("touchTap",this.hideAtkSkillMenu,this,!0),this.atkSkillMenu.visible=!1,this.addChild(this.atkSkillMenu)},e.prototype.createExtraSkillMenu=function(){this.extraSkillMenu=new VerticalLayout(this),this.es1Btn=new ImgBtn(this),this.es1Btn.addEventListener("touchTap",this.onEs1BtnTap,this),this.es2Btn=new ImgBtn(this),this.es2Btn.addEventListener("touchTap",this.onEs2BtnTap,this),this.es3Btn=new ImgBtn(this),this.es3Btn.addEventListener("touchTap",this.onEs3BtnTap,this),this.es4Btn=new ImgBtn(this),this.es4Btn.addEventListener("touchTap",this.onEs4BtnTap,this),this.es5Btn=new ImgBtn(this),this.es5Btn.addEventListener("touchTap",this.onEs5BtnTap,this),this.extraSkillMenu.x=86,this.extraSkillMenu.y=277,this.extraSkillMenu.layoutPaddingLeft=43,this.extraSkillMenu.layoutPaddingTop=53,this.extraSkillMenu.layoutBgColorAlpha=.5,this.extraSkillMenu.addLayoutChild(this.es1Btn),this.extraSkillMenu.addLayoutChild(this.es2Btn),this.extraSkillMenu.addLayoutChild(this.es3Btn),this.extraSkillMenu.addLayoutChild(this.es4Btn),this.extraSkillMenu.addLayoutChild(this.es5Btn),this.extraSkillMenu.touchEnabled=!0,this.extraSkillMenu.addEventListener("touchTap",this.hideAtkSkillMenu,this,!0),this.extraSkillMenu.visible=!1,this.addChild(this.extraSkillMenu)},e.prototype.showExtraSkillMenu=function(t){if(this.playerCamp===this.currentCamp)switch(this.extraSkillMenu.visible=!0,t){case"落石":this.es1Btn.visible=!0,this.es2Btn.visible=!0,this.es3Btn.visible=!0,this.es4Btn.visible=!0,this.es5Btn.visible=!0,this.es1Btn.text="北方",this.es2Btn.text="南方",this.es3Btn.text="东方",this.es4Btn.text="西方",this.es5Btn.text="取消";var e=this.checkLuoShiAvailable();this.es1Btn.touchEnabled=e[0],this.es1Btn.clickable=e[0],this.es2Btn.touchEnabled=e[1],this.es2Btn.clickable=e[1],this.es3Btn.touchEnabled=e[2],this.es3Btn.clickable=e[2],this.es4Btn.touchEnabled=e[3],this.es4Btn.clickable=e[3],this.es5Btn.touchEnabled=!0,this.es5Btn.clickable=!0;break;case"火烧赤壁":this.es1Btn.visible=!0,this.es2Btn.visible=!0,this.es3Btn.visible=!0,this.es4Btn.visible=!1,this.es5Btn.visible=!1,this.es1Btn.text="北半场",this.es2Btn.text="南半场",this.es3Btn.text="取消";var i=this.checkHSCBAvailable();this.es1Btn.touchEnabled=i[0],this.es1Btn.clickable=i[0],this.es2Btn.touchEnabled=i[1],this.es2Btn.clickable=i[1],this.es3Btn.touchEnabled=!0,this.es3Btn.clickable=!0}},e.prototype.hideExtraSkillMenu=function(){this.extraSkillMenu.visible=!1},e.prototype.onEsBtnTap=function(t){this.hideExtraSkillMenu();var e;switch(t){case 1:e=this.es1Btn;break;case 2:e=this.es2Btn;break;case 3:e=this.es3Btn;break;case 4:e=this.es4Btn;break;case 5:e=this.es5Btn}var i=e.text;return"取消"===i?void(this.extraSkillMessage={}):(this.extraSkillMessage.btnText=[],this.extraSkillMessage.btnText.push(i),void this.requestSkillStuff())},e.prototype.onEs1BtnTap=function(){this.onEsBtnTap(1)},e.prototype.onEs2BtnTap=function(){this.onEsBtnTap(2)},e.prototype.onEs3BtnTap=function(){this.onEsBtnTap(3)},e.prototype.onEs4BtnTap=function(){this.onEsBtnTap(4)},e.prototype.onEs5BtnTap=function(){this.onEsBtnTap(5)},e.prototype.createGameOverView=function(){this.gameOverView=new egret.Sprite,this.gameOverView.graphics.beginFill(0,.5),this.gameOverView.graphics.drawRect(0,0,750,1200),this.gameOverView.graphics.endFill(),this.gameOverText=new egret.TextField,this.gameOverText.x=20,this.gameOverText.y=500,this.gameOverText.text="南方胜利",this.gameOverText.width=720,this.gameOverText.textAlign="center",this.gameOverText.size=40,this.gameOverText.fontFamily="KaiTi",this.gameOverView.addChild(this.gameOverText),this.gameOverView.touchEnabled=!0,this.gameOverView.addEventListener("touchTap",this.operateFinishGameStuff,this,!0),this.gameOverView.visible=!1,this.addChild(this.gameOverView)},e.prototype.initWebSocket=function(){this.socket=GameSocket.getInstance(),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},e.prototype.onSocketOpen=function(t){},e.prototype.onSocketClose=function(t){console.log("close"),this.finish()},e.prototype.onSocketError=function(t){console.log("error"),this.finish()},e.prototype.finish=function(){this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket=null,this.startScene.addSocketListener(),this.startScene.enableAllTouchable(),this.par.removeChild(this)},e.prototype.onReceiveMessage=function(t){this.requestWaitEnd();var e=this.socket.readUTF();e=JSON.parse(e);var i=e.status;if(2===i)switch(this.operatedIndex=e.operatedIndex,this.targetIndex=e.targetIndex,e.action){case"colorMoveable":this.beginColorMoveStuff();break;case"moveGeneral":this.operateMoveStuff();break;case"colorAttackable":this.beginColorAttackStuff();break;case"attackGeneral":this.currentAtkSkill=e.atkSkill,this.operateAttackStuff();break;case"atkWall":this.operateAtkWallStuff();break;case"colorRevival":this.colorRevivalStuff();break;case"revivalGeneral":this.operateRevivalStuff();break;case"turnEnd":this.beginTurnEndStuff(-this.currentCamp),this.beginTurnStartStuff(this.currentCamp);break;case"turnStart":break;case"skill":this.extraSkillMessage=e.extraSkillMessage,this.operateSkillStuff()}},e.prototype.requestWaitStart=function(){this._waitingResponse=!0},e.prototype.requestWaitEnd=function(){this._waitingResponse=!1},e}(egret.Sprite);__reflect(GameScene.prototype,"GameScene");var LoadingScene=function(t){function e(e){var i=t.call(this)||this;return i.par=e,i.createScene(),i}return __extends(e,t),Object.defineProperty(e.prototype,"mainText",{get:function(){return this._mainText},set:function(t){this._mainText=t},enumerable:!0,configurable:!0}),e.prototype.createScene=function(){this.bg=new egret.Sprite,this.bg.graphics.beginFill(16777215,.5),this.bg.addEventListener("touchTap",this.onBgTap,this,!0)},e.prototype.onBgTap=function(){},e}(egret.Sprite);__reflect(LoadingScene.prototype,"LoadingScene");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Card=function(t){function e(e,i,a){var s=t.call(this)||this;return s._general=e,s.width=i,s.height=a,s.drawBg(),s.reDrawGeneralDetail(),s._clickable=!0,s.touchEnabled=!0,s.addEventListener("touchBegin",function(){this.alpha=.5},s),s.addEventListener("touchReleaseOutside",function(){this.alpha=this.clickable?1:.5},s),s.addEventListener("touchEnd",function(){this.alpha=this.clickable?1:.5},s),s}return __extends(e,t),Object.defineProperty(e.prototype,"general",{get:function(){return this._general},set:function(t){this._general=t,this.reDrawGeneralDetail()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clickable",{get:function(){return this._clickable},set:function(t){this._clickable!==t&&(this._clickable=t)},enumerable:!0,configurable:!0}),e.prototype.drawBg=function(){this.graphics.beginFill(10066329),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill()},e.prototype.reDrawGeneralDetail=function(){this.removeChildren();var t=new egret.TextField;t.x=10,t.y=10,t.textColor=16777215,t.width=200,t.height=100,t.size=35,t.text=this._general.name,this.addChild(t);var e=new egret.TextField;e.x=140,e.y=10,e.width=400,e.height=100,e.size=35,e.text="勇 "+this._general.yl+"  智 "+this._general.zm+"  C "+this._general.cost.toString(),this.addChild(e);
var i=new egret.TextField;i.x=25,i.y=100,i.width=360,i.height=400,i.size=35,i.text=this._general.skill.name+"  "+this._general.skill.type+"  Cost:"+this._general.skill.cost+"\n"+this._general.skill.text,this.addChild(i)},e}(egret.Sprite);__reflect(Card.prototype,"Card");var CardPool=function(t){function e(e){var i=t.call(this)||this;return i.width=600,i.height=500,i._generalList=e,i.reDraw(),i}return __extends(e,t),Object.defineProperty(e.prototype,"generalList",{get:function(){return this._generalList},set:function(t){this._generalList=t,this.reDraw(),this.checkBtnEnabled()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardIndex",{get:function(){return this._cardIndex},set:function(t){this._cardIndex=t,this.drawCard(),this.checkBtnEnabled()},enumerable:!0,configurable:!0}),e.prototype.reDraw=function(){this.removeChildren(),this.drawLRBtns(),this.prepareCards(),this.drawCard()},e.prototype.drawBg=function(){this.graphics.beginFill(4008636142),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill()},e.prototype.drawLRBtns=function(){var t=80,e=80;this.leftBtn=new ImgBtn(this,e,t),this.leftBtn.x=5,this.leftBtn.y=(this.height-t)/2,this.leftBtn.addEventListener("touchTap",this.onLeftBtnTap,this),this.addChild(this.leftBtn),this.rightBtn=new ImgBtn(this,e,t),this.rightBtn.x=this.width-5-e,this.rightBtn.y=(this.height-t)/2,this.rightBtn.addEventListener("touchTap",this.onRightBtnTap,this),this.addChild(this.rightBtn)},e.prototype.prepareCards=function(){this.cards=[],this._cardIndex=0;for(var t=0;t<this._generalList.length;t++){var e=this._generalList[t],i=new Card(e,400,this.height);this.cards.push(i)}},e.prototype.generateCard=function(t){return new Card(t,400,this.height)},e.prototype.checkBtnEnabled=function(){this._cardIndex<=0?(this.leftBtn.touchEnabled=!1,this.leftBtn.clickable=!1):(this.leftBtn.touchEnabled=!0,this.leftBtn.clickable=!0),this._cardIndex>=this.cards.length-1?(this.rightBtn.touchEnabled=!1,this.rightBtn.clickable=!1):(this.rightBtn.touchEnabled=!0,this.rightBtn.clickable=!0)},e.prototype.drawCard=function(){-1!=this.$children.indexOf(this.currentCard)&&this.removeChild(this.currentCard);var t=this._cardIndex;this.cards.length>0&&(this.currentCard=this.cards[t],this.currentCard.x=100,this.currentCard.y=0,this.addChild(this.currentCard),this.currentCard.addEventListener("touchTap",this.onCardTap,this))},e.prototype.onCardTap=function(){this.cardTapHandler&&this.cardTapHandler.handleCardTapEvent(this.currentCard)},e.prototype.onLeftBtnTap=function(t){this.cardIndex-=1,this.checkBtnEnabled()},e.prototype.onRightBtnTap=function(t){this.cardIndex+=1,this.checkBtnEnabled()},e}(egret.Sprite);__reflect(CardPool.prototype,"CardPool");var CheckBox=function(t){function e(e,i,a){void 0===i&&(i=491),void 0===a&&(a=76);var s=t.call(this)||this;return s._btnWidth=i,s._btnHeight=a,s._btnBgColor=7566195,s._btnBgColorAlpha=1,s._text="",s._textY=24,s._textSize=28,s._clickable=!0,s.touchEnabled=!0,s._selected=!1,s.reDraw(),s.addEventListener("touchBegin",function(){this.alpha=.5},s),s.addEventListener("touchReleaseOutside",function(){this.alpha=this.clickable?1:.5},s),s.addEventListener("touchEnd",function(){this.alpha=this.clickable?1:.5},s),s}return __extends(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,t?this._text="P":this._text="",this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnWidth",{get:function(){return this._btnWidth},set:function(t){this._btnWidth=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnHeight",{get:function(){return this._btnHeight},set:function(t){this._btnHeight=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnBgColor",{get:function(){return this._btnBgColor},set:function(t){this._btnBgColor=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnBgColorAlpha",{get:function(){return this._btnBgColorAlpha},set:function(t){this._btnBgColorAlpha=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textY",{get:function(){return this._textY},set:function(t){this._textY!==t&&(this._textY=t,this.reDraw())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSize",{get:function(){return this._textSize},set:function(t){this._textSize!==t&&(this._textSize=t,this.reDraw())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clickable",{get:function(){return this._clickable},set:function(t){this._clickable!==t&&(this._clickable=t,this.reDraw())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"img",{get:function(){return this._img},set:function(t){this._img!==t&&(this._img=t,this.reDraw())},enumerable:!0,configurable:!0}),e.prototype.reDraw=function(){this.graphics.clear(),this.removeChildren(),this.graphics.beginFill(this._btnBgColor,this._btnBgColorAlpha),this.graphics.drawRect(0,0,this._btnWidth,this._btnHeight),this.graphics.endFill(),this.img&&this.addChild(this.img),this.textView=new egret.TextField,this.textView.textColor=16777215,this.textView.size=this._textSize,this.textView.fontFamily="KaiTi",this.textView.text=this._text,this.textView.width=this.width,this.textView.textAlign="center",this.textView.y=this._textY,this.alpha=this.clickable?1:.5,this.addChild(this.textView)},e}(egret.Sprite);__reflect(CheckBox.prototype,"CheckBox");var Chess=function(t){function e(e,i){void 0===e&&(e="normal"),void 0===i&&(i=null);var a=t.call(this)||this;return a._status=e,a._general=i,a.camp=0,a.createTextFields(),a.reDraw(),a}return __extends(e,t),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},set:function(t){this._status!==t&&(this._status=t,this.reDrawBg())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"general",{get:function(){return this._general},set:function(t){this._general=t,this.drawTextFields()},enumerable:!0,configurable:!0}),e.prototype.reDraw=function(){this.reDrawBg(),this.drawTextFields()},e.prototype.reDrawBg=function(){this.graphics.clear();var t=16777215;switch(this.status){case"normal":t=16777215;break;case"normal_confirm":t=10066329;break;case"mover":t=15792383;break;case"moveable":t=11584734;break;case"moveable_confirm":t=13623799;break;case"attacker":t=16773365;break;case"attackable":t=16761035;break;case"attackable_confirm":t=16764374;break;case"revival":t=16773498;break;case"revival_confirm":t=16774562;break;case"skillable":t=8388522;break;case"skillable_confirm":t=64154}this.graphics.beginFill(t),this.graphics.drawRect(0,0,91,92),this.graphics.endFill()},e.prototype.createTextFields=function(){this.powerText=new egret.TextField,this.powerText.x=3,this.powerText.y=5,this.powerText.textColor=e.defaultTextColor,this.powerText.size=28,this.powerText.fontFamily="KaiTi",this.armsText=new egret.TextField,this.armsText.x=6,this.armsText.y=64,this.armsText.textColor=e.defaultTextColor,this.armsText.size=20,this.armsText.fontFamily="KaiTi",this.nameText=new egret.TextField,this.nameText.x=34,this.nameText.y=23,this.nameText.width=30,this.nameText.textColor=e.defaultTextColor,this.nameText.size=20,this.nameText.fontFamily="KaiTi",this.nameText.wordWrap=!0,this.nameText.lineSpacing=0,this.yongText=new egret.TextField,this.yongText.x=65,this.yongText.y=8,this.yongText.textColor=e.defaultTextColor,this.yongText.size=20,this.yongText.fontFamily="KaiTi",this.fuText=new egret.TextField,this.fuText.x=65,this.fuText.y=36,this.fuText.textColor=e.defaultTextColor,this.fuText.size=20,this.fuText.fontFamily="KaiTi",this.tlText=new egret.TextField,this.tlText.x=60,this.tlText.y=63,this.tlText.textColor=e.defaultTextColor,this.tlText.size=26,this.tlText.fontFamily="KaiTi",this.tlText.textAlign="right",this.addChild(this.powerText),this.addChild(this.armsText),this.addChild(this.nameText),this.addChild(this.yongText),this.addChild(this.fuText),this.addChild(this.tlText)},e.prototype.drawTextFields=function(){var t=this._general;t?(this.powerText.text=t.power,this.armsText.text=t.arms,this.nameText.text=t.name,this.yongText.text=t.yong?"勇":"",this.fuText.text=t.fu?"伏":"",this.tlText.text=t.tl.toString()):(this.powerText.text="",this.armsText.text="",this.nameText.text="",this.yongText.text="",this.fuText.text="",this.tlText.text="")},e.defaultTextColor=0,e}(egret.Sprite);__reflect(Chess.prototype,"Chess");var ChessBoard=function(t){function e(e){var i=t.call(this)||this;i.chesses=e;for(var a=0;6>a;a++)for(var s=0;6>s;s++){var r=0+95*a,n=0+94*s,o=e[a][s];o.x=n,o.y=r,i.addChild(o)}return i}return __extends(e,t),e}(egret.Sprite);__reflect(ChessBoard.prototype,"ChessBoard");var GeneralSingleLayout=function(t){function e(e,i,a){var s=t.call(this)||this;return s._layoutWidth=573,s._layoutHeight=50,s._layoutBgColor=15658734,s._layoutBgColorAlpha=0,s._layoutSpacing=20,s._layoutPaddingTop=0,s._layoutPaddingLeft=0,s._general=i,s._pos=a,s.reDraw(),s}return __extends(e,t),Object.defineProperty(e.prototype,"eventHandler",{get:function(){return this._chosenEventHandler},set:function(t){this._chosenEventHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"general",{get:function(){return this._general},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.gPos.text},set:function(t){this._pos=t,this.gPos.text=this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutWidth",{get:function(){return this._layoutWidth},set:function(t){this._layoutWidth=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutHeight",{get:function(){return this._layoutHeight},set:function(t){this._layoutHeight=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutBgColor",{get:function(){return this._layoutBgColor},set:function(t){this._layoutBgColor=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutBgColorAlpha",{get:function(){return this._layoutBgColorAlpha},set:function(t){this._layoutBgColorAlpha=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutPaddingTop",{get:function(){return this._layoutPaddingTop},set:function(t){this._layoutPaddingTop=t,this.reDrawChildren()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutPaddingLeft",{get:function(){return this._layoutPaddingLeft},set:function(t){this._layoutPaddingLeft=t,this.reDrawChildren()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutSpacing",{get:function(){return this._layoutSpacing},set:function(t){this._layoutSpacing=t,this.reDrawChildren()},enumerable:!0,configurable:!0}),e.prototype.reDraw=function(){this.graphics.clear(),this.graphics.beginFill(this._layoutBgColor,this._layoutBgColorAlpha),this.graphics.drawRect(0,0,this._layoutWidth,this._layoutHeight),this.graphics.endFill(),this.cancelBtn=new ImgBtn(this,50,50),this.cancelBtn.textY=10,this.cancelBtn.text="X",this.cancelBtn.addEventListener("touchTap",this.chosenEvent,this),this.addLayoutChild(this.cancelBtn),this.gName=new egret.TextField,this.gName.text=this.general.name,this.gName.y=10,this.addLayoutChild(this.gName),this.gCos=new egret.TextField,this.gCos.text=this.general.cost.toString(),this.gCos.y=10,this.addLayoutChild(this.gCos),this.gPos=new egret.TextField,this.gPos.width=50,this.gPos.y=10,this.gPos.restrict="0-5",this.gPos.text=this._pos,this.gPos.multiline=!1,this.gPos.verticalAlign=egret.VerticalAlign.MIDDLE,this.gPos.type=egret.TextFieldType.INPUT,this.gPos.background=!0,this.gPos.backgroundColor=16777215,this.gPos.textColor=0,this.gPos.addEventListener(egret.Event.CHANGE,this.inputPosListen,this),this.addLayoutChild(this.gPos)},e.prototype.chosenEvent=function(t){this._chosenEventHandler&&this._chosenEventHandler.handleChosenEvent(this._general)},e.prototype.inputPosListen=function(t){var e=t.target;if(e.text.length>1){var i=e.text,a=i.slice(0,1);e.text=a}},e.prototype.enableAllTouchable=function(){this.gPos.type=egret.TextFieldType.INPUT},e.prototype.disableAllTouchable=function(){this.gPos.type=egret.TextFieldType.DYNAMIC},e.prototype.reDrawChildren=function(){for(var t=[],e=0,i=this.$children.length;i>e;e++)t.push(this.$children[e]);this.removeChildren();for(var e=0,i=t.length;i>e;e++)this.addLayoutChild(t[e])},e.prototype.addLayoutChild=function(t,e){void 0===e&&(e=this.$children.length-1);var i=this.$children.length;if(0===i)t.x+=this._layoutPaddingLeft,t.y+=this._layoutPaddingTop,this.addChild(t);else{var a=this.getChildAt(i-1);t.x+=a.x+a.width+this._layoutSpacing,t.y+=this._layoutPaddingTop,this.addChild(t)}},e}(egret.Sprite);__reflect(GeneralSingleLayout.prototype,"GeneralSingleLayout");var HorizontalLayout=function(t){function e(e){var i=t.call(this)||this;return i._layoutWidth=573,i._layoutHeight=573,i._layoutBgColor=15658734,i._layoutBgColorAlpha=1,i._layoutSpacing=20,i._layoutPaddingTop=0,i._layoutPaddingLeft=0,i.reDraw(),i}return __extends(e,t),Object.defineProperty(e.prototype,"layoutWidth",{get:function(){return this._layoutWidth},set:function(t){this._layoutWidth=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutHeight",{get:function(){return this._layoutHeight},set:function(t){this._layoutHeight=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutBgColor",{get:function(){return this._layoutBgColor},set:function(t){this._layoutBgColor=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutBgColorAlpha",{get:function(){return this._layoutBgColorAlpha},set:function(t){this._layoutBgColorAlpha=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutPaddingTop",{get:function(){return this._layoutPaddingTop},set:function(t){this._layoutPaddingTop=t,this.reDrawChildren()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutPaddingLeft",{get:function(){return this._layoutPaddingLeft},set:function(t){this._layoutPaddingLeft=t,this.reDrawChildren()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutSpacing",{get:function(){return this._layoutSpacing},set:function(t){this._layoutSpacing=t,this.reDrawChildren()},enumerable:!0,configurable:!0}),e.prototype.reDraw=function(){this.graphics.clear(),this.graphics.beginFill(this._layoutBgColor,this._layoutBgColorAlpha),this.graphics.drawRect(0,0,this._layoutWidth,this._layoutHeight),this.graphics.endFill()},e.prototype.reDrawChildren=function(){for(var t=[],e=0,i=this.$children.length;i>e;e++)t.push(this.$children[e]);this.removeChildren();for(var e=0,i=t.length;i>e;e++)this.addLayoutChild(t[e])},e.prototype.addLayoutChild=function(t,e){void 0===e&&(e=this.$children.length-1);var i=this.$children.length;if(0===i)t.x=this._layoutPaddingLeft,t.y=this._layoutPaddingTop,this.addChild(t);else{var a=this.getChildAt(i-1);t.x=a.x+a.width+this._layoutSpacing,t.y=this._layoutPaddingTop,this.addChild(t)}},e}(egret.Sprite);__reflect(HorizontalLayout.prototype,"HorizontalLayout");var HurtedChess=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._general=e,i._bgColorAlpha=0,i._general&&(i._status=0===e.hurtTurns?"recover":"hurt"),i.camp=0,i.touchEnabled=!0,i.reDraw(),i.addEventListener("touchBegin",function(){this.bgColorAlpha=.5},i),i.addEventListener("touchReleaseOutside",function(){this.bgColorAlpha=0},i),i.addEventListener("touchEnd",function(){this.bgColorAlpha=0},i),i}return __extends(e,t),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},set:function(t){this._status!==status&&(this._status=t,this.setTextFieldsColor())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"general",{get:function(){return this._general},set:function(t){this._general=t,this.drawTextFields()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bgColorAlpha",{get:function(){return this._bgColorAlpha},set:function(t){this._bgColorAlpha=t,this.reDrawBg()},enumerable:!0,configurable:!0}),e.prototype.reDraw=function(){this.removeChildren(),this.reDrawBg(),this.createTextFields(),this.drawTextFields()},e.prototype.reDrawBg=function(){this.graphics.clear();var t=15658734;this.graphics.beginFill(t,this._bgColorAlpha),this.graphics.drawRect(0,0,60,87),this.graphics.endFill()},e.prototype.createTextFields=function(){this.nameText=new egret.TextField,this.nameText.x=12,this.nameText.y=25,this.nameText.size=25,this.nameText.width=30,this.nameText.fontFamily="KaiTi",this.nameText.wordWrap=!0,this.nameText.lineSpacing=0,this.hurtTurnsText=new egret.TextField,this.hurtTurnsText.x=38,this.hurtTurnsText.y=7,this.hurtTurnsText.size=25,this.hurtTurnsText.fontFamily="KaiTi",this.hurtTurnsText.wordWrap=!0,this.hurtTurnsText.lineSpacing=0,this.addChild(this.nameText),this.addChild(this.hurtTurnsText)},e.prototype.drawTextFields=function(){var t=this._general;t?(this.nameText.text=t.name,this.hurtTurnsText.text=String(t.hurtTurns),this._status=0===t.hurtTurns?"recover":"hurt",this.setTextFieldsColor()):(this.nameText.text="",this.hurtTurnsText.text="")},e.prototype.setTextFieldsColor=function(){var t=16777215;switch(this._status){case"hurt":t=13421772;break;case"hurt_confirm":t=16777215;break;case"recover":t=10863064;break;case"recover_confirm":t=13035007}this.nameText.textColor=t,this.hurtTurnsText.textColor=t},e}(egret.Sprite);__reflect(HurtedChess.prototype,"HurtedChess");var HurtedChessBoard=function(t){function e(e,i){var a=t.call(this,e)||this;a.chesses=i;for(var s=0,r=a.chesses.length;r>s;s++)a.addLayoutChild(a.chesses[s]);return a}return __extends(e,t),e}(VerticalLayout);__reflect(HurtedChessBoard.prototype,"HurtedChessBoard");var ImgBtn=function(t){function e(e,i,a){void 0===i&&(i=491),void 0===a&&(a=76);var s=t.call(this)||this;return s._btnWidth=i,s._btnHeight=a,s._btnBgColor=7566195,s._btnBgColorAlpha=1,s._text="",s._textY=24,s._textSize=28,s._clickable=!0,s.touchEnabled=!0,s.reDraw(),s.addEventListener("touchBegin",function(){this.alpha=.5},s),s.addEventListener("touchReleaseOutside",function(){this.alpha=this.clickable?1:.5},s),s.addEventListener("touchEnd",function(){this.alpha=this.clickable?1:.5},s),s}return __extends(e,t),Object.defineProperty(e.prototype,"btnWidth",{get:function(){return this._btnWidth},set:function(t){this._btnWidth=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnHeight",{get:function(){return this._btnHeight},set:function(t){this._btnHeight=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnBgColor",{get:function(){return this._btnBgColor},set:function(t){this._btnBgColor=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"btnBgColorAlpha",{get:function(){return this._btnBgColorAlpha},set:function(t){this._btnBgColorAlpha=t,this.reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this.reDraw())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textY",{get:function(){return this._textY},set:function(t){this._textY!==t&&(this._textY=t,this.reDraw())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSize",{get:function(){return this._textSize},set:function(t){this._textSize!==t&&(this._textSize=t,this.reDraw())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clickable",{get:function(){return this._clickable},set:function(t){this._clickable!==t&&(this._clickable=t,this.reDraw())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"img",{get:function(){return this._img},set:function(t){this._img!==t&&(this._img=t,this.reDraw())},enumerable:!0,configurable:!0}),e.prototype.reDraw=function(){this.graphics.clear(),this.removeChildren(),this.graphics.beginFill(this._btnBgColor,this._btnBgColorAlpha),this.graphics.drawRect(0,0,this._btnWidth,this._btnHeight),this.graphics.endFill(),this.img&&this.addChild(this.img),this.textView=new egret.TextField,this.textView.textColor=16777215,this.textView.size=this._textSize,this.textView.fontFamily="KaiTi",this.textView.text=this.text,this.textView.width=this.width,this.textView.textAlign="center",this.textView.y=this._textY,this.alpha=this.clickable?1:.5,this.addChild(this.textView)},e}(egret.Sprite);__reflect(ImgBtn.prototype,"ImgBtn");var GameSocket=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return this.gameSocket&&this.gameSocket.connected?this.gameSocket:(this.gameSocket=new e,this.gameSocket)},e}(egret.WebSocket);__reflect(GameSocket.prototype,"GameSocket");